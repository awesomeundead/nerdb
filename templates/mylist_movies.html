<div class="flex_row" id="userlist_checkbox">
    <div class="flex_column vcenter">
        <input data-filter="watchlist" id="watchlist_checkbox" type="checkbox" />
        <label for="watchlist_checkbox">Filmes que eu quero assistir</label>
    </div>        
    <div class="flex_column vcenter">
        <input data-filter="watched" id="watched_checkbox" type="checkbox" />
        <label for="watched_checkbox">Filmes assistidos</label>
    </div>
    <div class="flex_column vcenter">
        <input data-filter="liked" id="liked_checkbox" type="checkbox" />
        <label for="liked_checkbox">Filmes que eu gostei</label>
    </div>
    <div class="flex_column vcenter">
        <input data-filter="rating" id="rating_checkbox" type="checkbox" />
        <label for="rating_checkbox">Filmes que eu melhor avaliei</label>
    </div>
</div>
<div id="userlist">
    <div class="grid"></div>
</div>

<template>
    <div class="item flex_row">
        <div class="flex_column">
            <div class="image">
                <a href="">
                    <img alt="" src="" />
                </a>
            </div>
            <div class="flex_row">
                <div aria-label="Quero assistir" class="icon watchlist" title="Quero assistir">
                    <img alt="" src="saved.png" />
                </div>
                <div aria-label="Já assisti" class="icon watched" title="Já assisti">
                    <img alt="" src="watched.png" />
                </div>
                <div aria-label="Gostei" class="icon liked" title="Gostei">
                    <img alt="" src="liked.png" />
                </div>
                <div aria-label="Minha avaliação" class="icon_rating rating" title="Minha avaliação"></div>
            </div>
        </div>
        <div class="flex_row">
            <div>
                <div class="title title_br"></div>
            </div>
        </div>
    </div>
</template>

<script>

const container = document.querySelector('#userlist .grid');
const template = document.querySelector('template');
const url = new URL('api/v1/mylist/movies', document.baseURI);
const searchParams = url.searchParams;

const render = function({ movies })
{
    if (!movies.length)
    {
        container.innerHTML = '<div class="centralizado">Não foram encontrados filmes nesta lista.</div>';

        return;
    }
    
    container.innerHTML = '';

    movies.forEach(item =>
    {
        const clone = template.content.cloneNode(true);

        clone.querySelector('a').href = `movie/${item.id}`;        
        clone.querySelector('img').src = item.media?.trim() ? `images/256/${item.media}.webp` : 'noimage.png';
        clone.querySelector('.title_br').textContent =  item.title_br;

        if (!item.watchlist || item.watched)
        {
            clone.querySelector('.watchlist').remove();
        }

        if (!item.watched)
        {
            clone.querySelector('.watched').remove();
        }

        if (!item.liked)
        {
            clone.querySelector('.liked').remove();
        }

        if (item.rating)
        {
            clone.querySelector('.rating').textContent = item.rating;
        }
        else
        {
            clone.querySelector('.rating').remove();
        }

        container.appendChild(clone);
    });
}

document.querySelectorAll('#watchlist_checkbox, #watched_checkbox, #liked_checkbox, #rating_checkbox').forEach(item =>
{
    item.addEventListener('click', () =>
    {
        if (item.checked)
        {
            searchParams.set(item.dataset.filter, 1);
        }
        else
        {
            searchParams.delete(item.dataset.filter);
        }

        getJSON();
    });
});

getJSON();

</script>