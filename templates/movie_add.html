<form class="forms">
    <input name="title_br" placeholder="Título em português" required="required" type="text" />
    <input name="title_us" placeholder="Título em inglês" required="required" type="text" />
    <input name="director" list="directors" placeholder="Diretor" required="required" type="text" />
    <input name="genres" placeholder="Gêneros" type="text" />
    <input name="release_year" placeholder="Ano de lançamento" required="required" type="number" />
    <input name="imdb" placeholder="Link IMDB" type="text" />
    <button type="submit">Adicionar</button>
</form>

<script src="default.js"></script>
<script>

const form = document.querySelector('form.forms');

form.addEventListener('submit', e =>
{
    e.preventDefault();
    form.querySelector('[type="submit"]').disabled = true;

    add_movie(Object.fromEntries(new FormData(form)));
});

get_directors();

function add_movie(body)
{
    fetch('api/v1/movie',
    {
        body: JSON.stringify(body),
        headers:
        {
            //'Authorization': `ApiKey ${apikey}`,
            'Content-Type': 'application/json'
        },
        method: 'post'
    })
    .then(response =>
    {
        if (!response.ok)
        {
            throw new Error(response.statusText);
        }

        return response.json();
    })
    .then(json =>
    {
        if (json.hasOwnProperty('status'))
        {
            notification(json.status, {success: 'Sucesso.', failure: 'Falha.'});

            if (json.status == 'success')
            {
                form.reset();
            }
        }
        else
        {
            console.log(json);
        }

        form.querySelector('[type="submit"]').disabled = false;
    })
    .catch(error =>
    {
        form.querySelector('[type="submit"]').disabled = false;
        console.error(error);
    });
}

function get_directors()
{
    fetch('directors.json')
    .then(response => 
    {
        if (!response.ok)
        {
            throw new Error(response.statusText);
        }

        return response.json();
    })
    .then(json =>
    {
        const container = document.createElement('datalist');
        container.setAttribute('id', 'directors');

        json.directors.forEach(item =>
        {
            option = document.createElement('option');
            option.textContent = item;

            container.appendChild(option);
        });

        document.body.appendChild(container);

    })
    .catch(error =>
    {
        console.error('Erro ao carregar:', error);
    });
}

</script>