<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Filmes</title>
<link href="layout.css?260725" rel="stylesheet" />
<link href="default.css?250725" rel="stylesheet" />
<script src="auth.js?180725"></script>
</head>
<body>

<div id="app">
    <header>
        <div id="menu_mobile">
            <label>
                <input type="checkbox" />
            </label>
        </div>
        <nav>
            <a href="index.html">In√≠cio</a>
            <a href="top_movies.html">Top filmes</a>
            <a href="my_movie_list.html">Minha lista de filmes</a>
            <a href="friends.html">Meus amigos</a>
            <a href="add_movie.html">Adicionar filme</a>
        </nav>
    </header>
    <div class="flex" id="movies"></div>
</div>

<template>
    <div class="info flex_column">
        <div class="image">
            <a href="">
                <img alt="" src="" />
            </a>
        </div>
        <div class="flex_row">
            <div class="movie_id"></div>
            <div class="title_br"></div>
            <div class="director"></div>
            <div class="release_year"></div>
            <a class="update" href="update_movie.html" target="_blank">Editar</a>
        </div>
    </div>
</template>

<script>

const container = document.querySelector('#movies');
const template = document.querySelector('template');

load_movies();

function load_movies()
{
    fetch('api/v1/movies')
    .then(response =>
    {
        if (!response.ok)
        {
            throw new Error(response.statusText);
        }

        return response.json();
    })
    .then(json =>
    {
        render_movies(json.movies)
    })
    .catch(error =>
    {
        console.error(error);
    });
}

function render_movies(movies)
{
    container.innerHTML = '';

    movies.forEach(item =>
    {
        const clone = template.content.cloneNode(true);
        
        clone.querySelector('.image a').href = `movie.html?id=${item.id}&title=${item.title_us}`;
        clone.querySelector('.image img').src = (item.media == '') ? 'public/noimage.png' : `public/images/256/${item.media}.webp`;
        clone.querySelector('.movie_id').textContent =  `#${item.id}`;
        clone.querySelector('.title_br').textContent =  item.title_br;
        clone.querySelector('.director').textContent =  item.director;
        clone.querySelector('.release_year').textContent =  item.release_year;
        clone.querySelector('.update').href +=  `?id=${item.id}`;

        container.appendChild(clone);
    });
}

</script>

</body>
</html>