<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title></title>
<link href="layout.css" rel="stylesheet" />
<link href="default.css?11072025" rel="stylesheet" />
<script src="auth.js"></script>
<link href="https://unpkg.com/swiper/swiper-bundle.min.css" rel="stylesheet" />
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
<style>

#search input
{
    width: 300px;
}

.swiper
{
    height: 100%;
    padding: 20px 0;
    width: 100%;
}

.swiper-slide
{
    align-items: center;
    display: flex;
    justify-content: center;
    width: auto;
}

.swiper-slide img
{
    display: block;
    height: 100%;
    object-fit: cover;
    width: 100%;
}

</style>
</head>
<body>

<div id="app">
    <header>
        <nav>
            <a href="index.html">Início</a>
            <a href="my_movie_list.html">Minha lista de filmes</a>
            <a href="friends.html">Meus amigos</a>
            <a href="movies.html">Filmes cadastrados</a>
            <a href="add_movie.html">Adicionar filme</a>
        </nav>
        <button class="steam_connect" hidden="hidden" type="button">Conectar com Steam</button>
    </header>
    <section>
        <form action="movies.html" id="search">
            <input name="q" placeholder="Pesquisar por título ou lançamento" type="search" />
            <button type="submit">Ok</button>
        </form>
        <div class="swiper mySwiper">
            <div class="swiper-wrapper" id="movies_media"></div>
        </div>
        <template>
            <div class="swiper-slide">
                <a href="">
                    <img alt="" src="" />
                </a>
            </div>
        </template>
    </section>
</div>

<script>

const steam_connect = document.querySelector('.steam_connect');
const container = document.querySelector('#movies_media');
const template = document.querySelector('template');

steam_connect.addEventListener('click', () =>
{
    window.location.href = 'auth.php?login';
});

is_logged_in();
load_movies();

async function is_logged_in()
{
    const logged_in = await login();

    if (logged_in)
    {
        steam_connect.remove();
    }
    else
    {
        steam_connect.hidden = false;
    }
}

function load_movies()
{
    fetch('api/v1/movies?order=random')
    .then(response =>
    {
        if (!response.ok)
        {
            throw new Error(response.statusText);
        }

        return response.json();
    })
    .then(json =>
    {
        render_movies(json.movies)
    })
    .catch(error =>
    {
        console.error(error);
    });
}

function render_movies(movies)
{
    container.innerHTML = '';

    movies.forEach(item =>
    {
        const clone = template.content.cloneNode(true);

        clone.querySelector('a').href += `#${item.title_br}`;
        clone.querySelector('img').src = `public/images/256/${item.media}.webp`;

        container.appendChild(clone);
    });

    const swiper = new Swiper('.mySwiper', {
        slidesPerView: 'auto',
        spaceBetween: 5,
        freeMode: true
    });
}

</script>

</body>
</html>